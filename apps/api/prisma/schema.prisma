generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ctml_schema {
  id         Int         @id @default(autoincrement())
  version    String      @unique
  schema     String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  // Many trials to many schema_ctml records
  trials     trial[]
  ctml_jsons ctml_json[]
}

model ctml_json {
  id        Int         @id @default(autoincrement())
  version   ctml_schema @relation(fields: [versionId], references: [id])
  versionId Int
  // This should be encrypted
  data      Json?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  // One trial to many ctml_json records
  trial     trial    @relation(fields: [trial_id], references: [id], onDelete: Cascade)
  trial_id  Int
}

model trial {
  id                     Int           @id @default(autoincrement())
  nct_id                 String
  nickname               String?
  principal_investigator String?
  status                 status?       @default(DRAFT)
  // Many trials to many ctml_schema records
  ctml_schemas           ctml_schema[]
  // One trial to many ctml_json records
  ctml_jsons             ctml_json[]
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  createdBy              user?         @relation("createdBy", fields: [userId], references: [id])
  modifiedBy             user?         @relation("modifiedBy", fields: [modifiedById], references: [id])
  userId                 Int?
  modifiedById           Int?
}

model user {
  id              Int      @id @default(autoincrement())
  email           String   @unique
  firstName       String?
  lastName        String?
  created_trials  trial[]  @relation("createdBy")
  modified_trials trial[]  @relation("modifiedBy")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum status {
  DRAFT
  IN_REVIEW
  COMPLETED
}
